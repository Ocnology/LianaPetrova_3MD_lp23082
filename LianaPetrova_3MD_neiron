{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/lianapetrova/lianapetrova-lp23082-3md?scriptVersionId=232520091\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"36be1fca","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","execution":{"iopub.execute_input":"2025-04-07T20:52:46.19751Z","iopub.status.busy":"2025-04-07T20:52:46.197091Z","iopub.status.idle":"2025-04-07T20:53:43.287307Z","shell.execute_reply":"2025-04-07T20:53:43.286005Z"},"papermill":{"duration":57.095822,"end_time":"2025-04-07T20:53:43.288818","exception":false,"start_time":"2025-04-07T20:52:46.192996","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).\n"]},{"name":"stdout","output_type":"stream","text":["Saglabātais modelis ielādēts.\n"]},{"data":{"text/html":[],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["Modela klasifikācijas pārskats:\n","                 precision    recall  f1-score   support\n","\n","Not Recommended       0.79      0.58      0.67        26\n","    Recommended       0.94      0.98      0.96       174\n","\n","       accuracy                           0.93       200\n","      macro avg       0.86      0.78      0.81       200\n","   weighted avg       0.92      0.93      0.92       200\n","\n","\n","50 nejauši izvēlēti komentāri un prognozes:\n","\n","\n","--- 1 ---\n","Komentārs: Left 4 Dead 2 is an amazingly good game, I've played 30 hours of this game, I know this may be a short recommendation but, BUY THIS GAME.... NOW!!!!\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.45%)\n","\n","--- 2 ---\n","Komentārs: i love this game AWESOME never a game that you get board of!! ITS AWEOME\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.47%)\n","\n","--- 3 ---\n","Komentārs: Great game &amp; community, the only thing left to say is ALLAHU AKBARRRRRRRRRRRRRRR\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.28%)\n","\n","--- 4 ---\n","Komentārs: Love this game! &lt;3\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.44%)\n","\n","--- 5 ---\n","Komentārs: 10/10 would get ♥♥♥♥ed in the ♥♥♥ by Activision again\n","Patiesais vērtējums: NEGATĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 98.69%)\n","\n","--- 6 ---\n","Komentārs: This game is filled to the brim with sarcastic sh*theads.  And I wouldnt want to have it any other way.  10/10\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.08%)\n","\n","--- 7 ---\n","Komentārs: Very good game 8,5/10  very big fan of black ops era Dont buy if you have a shity pc  \n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.34%)\n","\n","--- 8 ---\n","Komentārs: Great story and visuals. The battles get pretty fun by then end.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.50%)\n","\n","--- 9 ---\n","Komentārs: This game has brought me more hours of fun and challenge as a pick up and play kinda game than many other that I've played in its genre.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.44%)\n","\n","--- 10 ---\n","Komentārs: This is actually pretty fun.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.47%)\n","\n","--- 11 ---\n","Komentārs: At first I thought it may have been a glitch. Now I realise it is actually Demonite.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 96.35%)\n","\n","--- 12 ---\n","Komentārs: Best game in the world ever .\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.50%)\n","\n","--- 13 ---\n","Komentārs: the game crushs everytime i just want to play the god damm game\n","Patiesais vērtējums: NEGATĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 98.94%)\n","\n","--- 14 ---\n","Komentārs: First off: this peice of ♥♥♥♥ lags,terribly,mainly due to the incredibly stupid ♥♥♥♥ing decission to matchmake Europeans with the east state blocks,Russians,Latvians,Polish and so on,idiocy on a high ...\n","Patiesais vērtējums: NEGATĪVS\n","Modeļa prognoze: NEGATĪVS (ticamība: 93.30%)\n","\n","--- 15 ---\n","Komentārs: Hey, thats pretty good \n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.42%)\n","\n","--- 16 ---\n","Komentārs: Game unlocked on the Steam Store at 3 AM. Within the next hour, my mother bursted in the room furious because I had woken up everyone in the house with my cheering, shouting, pounding, and yelling.  I...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 98.65%)\n","\n","--- 17 ---\n","Komentārs: I love the battle system mechanics and the Sans battle really puts your skills to the test. I don't worship this game like some people do, but it really is a great RPG and if you're reading this revie...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.47%)\n","\n","--- 18 ---\n","Komentārs: Goes great with the Allahu Akcbar mod\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.31%)\n","\n","--- 19 ---\n","Komentārs: Made my computer blue screen when changing vsync options...\n","Patiesais vērtējums: NEGATĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 94.45%)\n","\n","--- 20 ---\n","Komentārs: Nice game\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.45%)\n","\n","--- 21 ---\n","Komentārs: Love the game! cant wait for bannerlord!!! :D\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.37%)\n","\n","--- 22 ---\n","Komentārs: The open world of this game is just amazing, so many hours put into the little things you see, which makes for a better overall experience. Great story mode with excellent actors and online that has m...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 96.84%)\n","\n","--- 23 ---\n","Komentārs: By the power of Greyskull, I HAVE THE CRITS!!!\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.21%)\n","\n","--- 24 ---\n","Komentārs: I have played somewhere between 40-50 hours and I'm prepared to state that not only have I only scratched the surface of this mystical masterpiece but it is also one of the best games that I've ever p...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.44%)\n","\n","--- 25 ---\n","Komentārs: Cool game, I like multiplayer the most.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.49%)\n","\n","--- 26 ---\n","Komentārs: In small doses NMS delivers a satisying casual gaming experience that warrants attention. There's some fantastic design here including a great soundtrack. But be aware extended play can become repetit...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 96.76%)\n","\n","--- 27 ---\n","Komentārs: Game wont load i have downloaded so many files that people have said and still wont work... i have waited so long and im getting ♥♥♥♥♥♥\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 97.59%)\n","\n","--- 28 ---\n","Komentārs: I enjoyed this game. I found not having something constantly telling me where to go or what to do welcoming. There is a little quest HUD in the bottom right hand corner, but you can change what it is ...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.12%)\n","\n","--- 29 ---\n","Komentārs: This game ruined my life 10/10 would play to ruin their life\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.23%)\n","\n","--- 30 ---\n","Komentārs: it was an amaing game and it was a fun experience\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.46%)\n","\n","--- 31 ---\n","Komentārs: As expected very fun. Great puzzle game and I can't wait to complete the multiplayer campaign.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.49%)\n","\n","--- 32 ---\n","Komentārs: I like being a robber... 10/10 'Would rob in real life' - Alienzone51  Edit: Went to rob a shopping mall and got shot in the leg 3 times... Worth it :)\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.34%)\n","\n","--- 33 ---\n","Komentārs: 10/10 would terraria again.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.14%)\n","\n","--- 34 ---\n","Komentārs: Awesome game! It fulfills my craving for HOURS of fun! The creators are constantly creating new updates! Best!\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.47%)\n","\n","--- 35 ---\n","Komentārs: ♥♥♥♥♥♥♥ this ♥♥♥♥ing game. Just ♥♥♥♥♥♥♥ it.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 80.77%)\n","\n","--- 36 ---\n","Komentārs: 11/10 best Waiting Simulator game ever created.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.44%)\n","\n","--- 37 ---\n","Komentārs: This game is the definition of what a realistic shooting game should be. \n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.39%)\n","\n","--- 38 ---\n","Komentārs: for online co-op its awesome, great community of players and lots of fun, the replay on levels is great with everytime you play it, it changes just a little.  great sound track and lots of fun. the on...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.48%)\n","\n","--- 39 ---\n","Komentārs: it is soo cool that i pooped my pants that is how awesome it is (p.s. i didn't really poop my pants but its still awesome).\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.47%)\n","\n","--- 40 ---\n","Komentārs: Amazing third person action rpg game that lacks a diversity in enemies and can get repititive at times\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.42%)\n","\n","--- 41 ---\n","Komentārs: Love it!\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.39%)\n","\n","--- 42 ---\n","Komentārs: A mindblowing story wrapped in addictive gameplay. A masterpiece.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.48%)\n","\n","--- 43 ---\n","Komentārs: lot of fun..but some people in game like to insult each others and lot of racism..\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 98.54%)\n","\n","--- 44 ---\n","Komentārs: Doom, which I hold in high regard as the greatest first person shooter of all time, was a game I never thought could be matched, and while games like Serious Sam or Star Wars: Dark Forces come very cl...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.36%)\n","\n","--- 45 ---\n","Komentārs: Amazing game One word 1.3 \n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.51%)\n","\n","--- 46 ---\n","Komentārs: Sorry but the grind is just unreal, this coming from a World of Tanks player.\n","Patiesais vērtējums: NEGATĪVS\n","Modeļa prognoze: NEGATĪVS (ticamība: 93.42%)\n","\n","--- 47 ---\n","Komentārs: A beautiful, solid shooter for the first 5 hours.  After that, the developers ramp the difficulty way up. Obviously, they want to encourage players to microtransact, but if you're the type that resist...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 78.28%)\n","\n","--- 48 ---\n","Komentārs: 10/10 Would wipe my memory and play again\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.08%)\n","\n","--- 49 ---\n","Komentārs: Honestly the greatest game of all time.\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.47%)\n","\n","--- 50 ---\n","Komentārs: Within the short time playing this game I have found great joy. Once again in the series i find myself impressed with whats in front of me. Recommened for any kind of gamer. Your in for a joyride. Pro...\n","Patiesais vērtējums: POZITĪVS\n","Modeļa prognoze: POZITĪVS (ticamība: 99.33%)\n"]}],"source":["# Sistēmas konfigurācija un bibliotēku ielāde\n","import os\n","import warnings\n","warnings.filterwarnings('ignore')\n","os.environ[\"WANDB_DISABLED\"] = \"true\"\n","\n","# Importē nepieciešamās bibliotēkas\n","import pandas as pd\n","import numpy as np\n","from sklearn.model_selection import train_test_split\n","from sklearn.metrics import classification_report, accuracy_score\n","import torch\n","from transformers import (\n","    DistilBertTokenizerFast,\n","    DistilBertForSequenceClassification,\n","    Trainer,\n","    TrainingArguments\n",")\n","\n","# Datu ielāde un apstrāde\n","# Tiek izmantoti Steam spēļu atsauksmju dati\n","\n","# Ielādē CSV failu un attīra datus\n","# Izvēlamies tikai pozitīvās (1) un negatīvās (-1) atsauksmes\n","df = pd.read_csv('/kaggle/input/liana-petrova-lp23082-3md/dataset_top20_cleaned.csv', sep='\\t')\n","df = df.dropna(subset=['review_text', 'review_score'])\n","df = df[df['review_score'].isin([1, -1])]\n","df['label'] = df['review_score'].apply(lambda x: 1 if x == 1 else 0)\n","df = df.sample(n=2000, random_state=42)\n","\n","# Datu sadalīšana treniņu un validācijas kopās\n","train_texts, val_texts, train_labels, val_labels = train_test_split(\n","    df['review_text'].tolist(), df['label'].tolist(), test_size=0.1, random_state=42\n",")\n","\n","# Atsauksmju tekstu konvertēšana uz modeļa ievades formātu\n","# Maksimālais garums ir ierobežots līdz 128 vārdiem (efektivitātei)\n","tokenizer = DistilBertTokenizerFast.from_pretrained(\"/kaggle/input/saved-model\")\n","train_encodings = tokenizer(train_texts, truncation=True, padding=True, max_length=128)\n","val_encodings = tokenizer(val_texts, truncation=True, padding=True, max_length=128)\n","\n","# Dataset klases definēšana — nepieciešams PyTorch\n","class SteamDataset(torch.utils.data.Dataset):\n","    def __init__(self, encodings, labels):\n","        self.encodings = encodings\n","        self.labels = labels\n","\n","    def __getitem__(self, idx):\n","        item = {key: torch.tensor(val[idx]) for key, val in self.encodings.items()}\n","        item['labels'] = torch.tensor(self.labels[idx])\n","        return item\n","\n","    def __len__(self):\n","        return len(self.labels)\n","\n","train_dataset = SteamDataset(train_encodings, train_labels)\n","val_dataset = SteamDataset(val_encodings, val_labels)\n","\n","# Modeļa ielāde (vai jauna apmācība, ja nav saglabāts)\n","model_path = \"/kaggle/input/saved-model\"\n","if os.path.exists(model_path):\n","    model = DistilBertForSequenceClassification.from_pretrained(model_path)\n","    tokenizer = DistilBertTokenizerFast.from_pretrained(model_path)\n","    print(\"Saglabātais modelis ielādēts.\")\n","else:\n","    print(\"Sāk jaunu modeļa apmācību...\")\n","    model = DistilBertForSequenceClassification.from_pretrained(\n","        \"distilbert-base-uncased\", num_labels=2\n","    )\n","\n","    # Apmācības parametri\n","    training_args = TrainingArguments(\n","        output_dir='./results',\n","        num_train_epochs=3,\n","        per_device_train_batch_size=8,\n","        per_device_eval_batch_size=8,\n","        evaluation_strategy=\"epoch\",\n","        save_strategy=\"epoch\",\n","        warmup_steps=100,\n","        weight_decay=0.01,\n","        logging_strategy=\"epoch\",\n","        load_best_model_at_end=True,\n","        metric_for_best_model=\"accuracy\",\n","        report_to=\"none\"\n","    )\n","\n","    # Funkcija metrikas aprēķināšanai\n","    def compute_metrics(eval_pred):\n","        logits, labels = eval_pred\n","        predictions = np.argmax(logits, axis=1)\n","        acc = accuracy_score(labels, predictions)\n","        return {\"accuracy\": acc}\n","\n","    # Apmācība ar Trainer klasi\n","    trainer = Trainer(\n","        model=model,\n","        args=training_args,\n","        train_dataset=train_dataset,\n","        eval_dataset=val_dataset,\n","        compute_metrics=compute_metrics\n","    )\n","\n","    trainer.train()\n","\n","    # Saglabā apmācīto modeli\n","    model.save_pretrained(model_path)\n","    tokenizer.save_pretrained(model_path)\n","    print(\"Modelis saglabāts.\")\n","\n","# Modeļa novērtēšana uz validācijas datiem\n","trainer = Trainer(model=model)\n","preds = trainer.predict(val_dataset)\n","pred_labels = np.argmax(preds.predictions, axis=1)\n","print(\"Modela klasifikācijas pārskats:\")\n","print(classification_report(val_labels, pred_labels, target_names=['Not Recommended', 'Recommended']))\n","\n","# Modela prognožu demonstrācija uz 50 nejaušiem komentāriem\n","print(\"\\n50 nejauši izvēlēti komentāri un prognozes:\\n\")\n","sample_df = df.sample(n=50).reset_index(drop=True)\n","\n","for i, row in sample_df.iterrows():\n","    text = row['review_text']\n","    true_label = \"POZITĪVS\" if row['label'] == 1 else \"NEGATĪVS\"\n","    encoding = tokenizer(text, truncation=True, padding=True, max_length=128, return_tensors='pt')\n","    with torch.no_grad():\n","        output = model(**encoding)\n","        pred = torch.argmax(output.logits, dim=1).item()\n","        prob = torch.softmax(output.logits, dim=1).squeeze()[pred].item()\n","\n","    predicted = \"POZITĪVS\" if pred == 1 else \"NEGATĪVS\"\n","\n","    print(f\"\\n--- {i+1} ---\")\n","    print(f\"Komentārs: {text[:200]}{'...' if len(text) > 200 else ''}\")\n","    print(f\"Patiesais vērtējums: {true_label}\")\n","    print(f\"Modeļa prognoze: {predicted} (ticamība: {prob:.2%})\")\n","\n","# Funkcija jaunu komentāru prognozēšanai\n","def predict_sentiment(comment: str):\n","    encoding = tokenizer(comment, truncation=True, padding=True, max_length=128, return_tensors='pt')\n","    with torch.no_grad():\n","        output = model(**encoding)\n","        prediction = torch.argmax(output.logits, dim=1).item()\n","        prob = torch.softmax(output.logits, dim=1).squeeze()[prediction].item()\n","\n","    if prediction == 1:\n","        print(f\"\\nKomentārs ir POZITĪVS (ticamība: {prob:.2%})\")\n","    else:\n","        print(f\"\\nKomentārs ir NEGATĪVS (ticamība: {prob:.2%})\")"]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":7058360,"sourceId":11288597,"sourceType":"datasetVersion"},{"datasetId":7067866,"sourceId":11301742,"sourceType":"datasetVersion"}],"dockerImageVersionId":30918,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.12"},"papermill":{"default_parameters":{},"duration":62.497071,"end_time":"2025-04-07T20:53:46.36723","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-04-07T20:52:43.870159","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}